{"version":3,"file":"table/relation.js","mappings":"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","sources":["webpack://phpmyadmin/external var \"jQuery\"","webpack://phpmyadmin/./resources/js/src/table/relation.ts"],"sourcesContent":["module.exports = jQuery;","import $ from 'jquery';\nimport { AJAX } from '../modules/ajax.ts';\nimport { CommonParams } from '../modules/common.ts';\nimport { ajaxRemoveMessage, ajaxShowMessage } from '../modules/ajax-message.ts';\nimport getJsConfirmCommonParam from '../modules/functions/getJsConfirmCommonParam.ts';\nimport { escapeHtml } from '../modules/functions/escape.ts';\nimport refreshMainContent from '../modules/functions/refreshMainContent.ts';\n/**\n * for table relation\n */\nconst showHideClauses = function ($thisDropdown) {\n    if ($thisDropdown.val() === '') {\n        $thisDropdown.parent().nextAll('span').hide();\n    }\n    else {\n        if ($thisDropdown.is('select[name^=\"destination_foreign_column\"]')) {\n            $thisDropdown.parent().nextAll('span').show();\n        }\n    }\n};\n/**\n * Sets dropdown options to values\n * @param $dropdown\n * @param values\n * @param selectedValue\n */\nconst setDropdownValues = function ($dropdown, values, selectedValue = undefined) {\n    $dropdown.empty();\n    var optionsAsString = '';\n    // add an empty string to the beginning for empty selection\n    values.unshift('');\n    $.each(values, function () {\n        optionsAsString += '<option value=\\'' + escapeHtml(this) + '\\'' + (selectedValue === escapeHtml(this) ? ' selected=\\'selected\\'' : '') + '>' + escapeHtml(this) + '</option>';\n    });\n    $dropdown.append($(optionsAsString));\n};\n/**\n * Retrieves and populates dropdowns to the left based on the selected value\n *\n * @param $dropdown the dropdown whose value got changed\n */\nconst getDropdownValues = function ($dropdown) {\n    var foreignDb = null;\n    var foreignTable = null;\n    var $databaseDd;\n    var $tableDd;\n    var $columnDd;\n    var foreign = '';\n    // if the changed dropdown is for foreign key constraints\n    if ($dropdown.is('select[name^=\"destination_foreign\"]')) {\n        $databaseDd = $dropdown.parent().parent().parent().find('select[name^=\"destination_foreign_db\"]');\n        $tableDd = $dropdown.parent().parent().parent().find('select[name^=\"destination_foreign_table\"]');\n        $columnDd = $dropdown.parent().parent().parent().find('select[name^=\"destination_foreign_column\"]');\n        foreign = '_foreign';\n    }\n    else { // internal relations\n        $databaseDd = $dropdown.parent().find('select[name^=\"destination_db\"]');\n        $tableDd = $dropdown.parent().find('select[name^=\"destination_table\"]');\n        $columnDd = $dropdown.parent().find('select[name^=\"destination_column\"]');\n    }\n    // if the changed dropdown is a database selector\n    if ($dropdown.is('select[name^=\"destination' + foreign + '_db\"]')) {\n        foreignDb = $dropdown.val();\n        // if no database is selected empty table and column dropdowns\n        if (foreignDb === '') {\n            TableRelation.setDropdownValues($tableDd, []);\n            TableRelation.setDropdownValues($columnDd, []);\n            return;\n        }\n    }\n    else { // if a table selector\n        foreignDb = $databaseDd.val();\n        foreignTable = $dropdown.val();\n        // if no table is selected empty the column dropdown\n        if (foreignTable === '') {\n            TableRelation.setDropdownValues($columnDd, []);\n            return;\n        }\n    }\n    var $msgbox = ajaxShowMessage();\n    var $form = $dropdown.parents('form');\n    var $db = $form.find('input[name=\"db\"]').val();\n    var $table = $form.find('input[name=\"table\"]').val();\n    var argsep = CommonParams.get('arg_separator');\n    var params = 'getDropdownValues=true' + argsep + 'ajax_request=true' +\n        argsep + 'db=' + encodeURIComponent($db) +\n        argsep + 'table=' + encodeURIComponent($table) +\n        argsep + 'foreign=' + (foreign !== '') +\n        argsep + 'foreignDb=' + encodeURIComponent(foreignDb) +\n        (foreignTable !== null ?\n            argsep + 'foreignTable=' + encodeURIComponent(foreignTable) : '');\n    var $server = $form.find('input[name=\"server\"]');\n    if ($server.length > 0) {\n        params += argsep + 'server=' + $form.find('input[name=\"server\"]').val();\n    }\n    $.ajax({\n        type: 'POST',\n        url: 'index.php?route=/table/relation',\n        data: params,\n        dataType: 'json',\n        success: function (data) {\n            ajaxRemoveMessage($msgbox);\n            if (typeof data !== 'undefined' && data.success) {\n                // if the changed dropdown is a database selector\n                if (foreignTable === null) {\n                    // set values for table and column dropdowns\n                    TableRelation.setDropdownValues($tableDd, data.tables);\n                    TableRelation.setDropdownValues($columnDd, []);\n                }\n                else { // if a table selector\n                    // set values for the column dropdown\n                    var primary = null;\n                    if (typeof data.primary !== 'undefined'\n                        && 1 === data.primary.length) {\n                        primary = data.primary[0];\n                    }\n                    TableRelation.setDropdownValues($columnDd.first(), data.columns, primary);\n                    TableRelation.setDropdownValues($columnDd.slice(1), data.columns);\n                }\n            }\n            else {\n                ajaxShowMessage(data.error, false);\n            }\n        }\n    });\n};\nconst TableRelation = {\n    showHideClauses: showHideClauses,\n    setDropdownValues: setDropdownValues,\n    getDropdownValues: getDropdownValues,\n};\n/**\n * Unbind all event handlers before tearing down a page\n */\nAJAX.registerTeardown('table/relation.js', function () {\n    $('body').off('change', 'select[name^=\"destination_db\"], ' +\n        'select[name^=\"destination_table\"], ' +\n        'select[name^=\"destination_foreign_db\"], ' +\n        'select[name^=\"destination_foreign_table\"]');\n    $('body').off('click', 'a.add_foreign_key_field');\n    $('body').off('click', 'a.add_foreign_key');\n    $('a.drop_foreign_key_anchor.ajax').off('click');\n});\nAJAX.registerOnload('table/relation.js', function () {\n    /**\n     * Ajax event handler to fetch table/column dropdown values.\n     */\n    $('body').on('change', 'select[name^=\"destination_db\"], ' +\n        'select[name^=\"destination_table\"], ' +\n        'select[name^=\"destination_foreign_db\"], ' +\n        'select[name^=\"destination_foreign_table\"]', function () {\n        TableRelation.getDropdownValues($(this));\n    });\n    /**\n     * Ajax event handler to add a column to a foreign key constraint.\n     */\n    $('body').on('click', 'a.add_foreign_key_field', function (event) {\n        event.preventDefault();\n        event.stopPropagation();\n        // Add field.\n        $(this)\n            .prev('span')\n            .clone(true, true)\n            .insertBefore($(this))\n            .find('select')\n            .val('');\n        // Add foreign field.\n        var $sourceElem = $('select[name^=\"destination_foreign_column[' +\n            $(this).attr('data-index') + ']\"]').last().parent();\n        $sourceElem\n            .clone(true, true)\n            .insertAfter($sourceElem)\n            .find('select')\n            .val('');\n    });\n    /**\n     * Ajax event handler to add a foreign key constraint.\n     */\n    $('body').on('click', 'a.add_foreign_key', function (event) {\n        event.preventDefault();\n        event.stopPropagation();\n        var $prevRow = $(this).closest('tr').prev('tr');\n        var $newRow = $prevRow.clone(true, true);\n        // Update serial number.\n        var currIndex = $newRow\n            .find('a.add_foreign_key_field')\n            .attr('data-index');\n        var newIndex = parseInt(currIndex) + 1;\n        $newRow.find('a.add_foreign_key_field').attr('data-index', newIndex);\n        // Update form parameter names.\n        $newRow.find('select[name^=\"foreign_key_fields_name\"]')\n            .not($newRow.find('select[name^=\"foreign_key_fields_name\"]').first())\n            .find('select[name^=\"destination_foreign_column\"]')\n            .not($newRow.find('select[name^=\"foreign_key_fields_name\"]')\n            .not($newRow.find('select[name^=\"foreign_key_fields_name\"]').first())\n            .find('select[name^=\"destination_foreign_column\"]').first()).each(function () {\n            $(this).parent().remove();\n        });\n        $newRow.find('input, select').each(function () {\n            $(this).attr('name', $(this).attr('name').replace(/\\d/, newIndex.toString()));\n        });\n        $newRow.find('input[type=\"text\"]').each(function () {\n            $(this).val('');\n        });\n        // Finally add the row.\n        $newRow.insertAfter($prevRow);\n    });\n    /**\n     * Ajax Event handler for 'Drop Foreign key'\n     */\n    $('a.drop_foreign_key_anchor.ajax').on('click', function (event) {\n        event.preventDefault();\n        var $anchor = $(this);\n        // Object containing reference to the current field's row\n        var $currRow = $anchor.parents('tr');\n        var dropQuery = escapeHtml($currRow.children('td')\n            .children('.drop_foreign_key_msg')\n            .val());\n        var question = window.sprintf(window.Messages.strDoYouReally, dropQuery);\n        $anchor.confirm(question, $anchor.attr('href'), function (url) {\n            var $msg = ajaxShowMessage(window.Messages.strDroppingForeignKey, false);\n            var params = getJsConfirmCommonParam(this, $anchor.getPostData());\n            $.post(url, params, function (data) {\n                if (data.success === true) {\n                    ajaxRemoveMessage($msg);\n                    refreshMainContent(false);\n                    AJAX.callback = () => {\n                        // Do nothing\n                    };\n                }\n                else {\n                    ajaxShowMessage(window.Messages.strErrorProcessingRequest + ' : ' + data.error, false);\n                }\n            }); // end $.post()\n        });\n    }); // end Drop Foreign key\n    var windowWidth = $(window).width();\n    $('.jsresponsive').css('max-width', (windowWidth - 35) + 'px');\n});\n"],"names":["$","AJAX","CommonParams","ajaxRemoveMessage","ajaxShowMessage","getJsConfirmCommonParam","escapeHtml","refreshMainContent","showHideClauses","$thisDropdown","val","parent","nextAll","hide","is","show","setDropdownValues","$dropdown","values","selectedValue","arguments","length","undefined","empty","optionsAsString","unshift","each","append","getDropdownValues","foreignDb","foreignTable","$databaseDd","$tableDd","$columnDd","foreign","find","TableRelation","$msgbox","$form","parents","$db","$table","argsep","get","params","encodeURIComponent","$server","ajax","type","url","data","dataType","success","tables","primary","first","columns","slice","error","registerTeardown","off","registerOnload","on","event","preventDefault","stopPropagation","prev","clone","insertBefore","$sourceElem","attr","last","insertAfter","$prevRow","closest","$newRow","currIndex","newIndex","parseInt","not","remove","replace","toString","$anchor","$currRow","dropQuery","children","question","window","sprintf","Messages","strDoYouReally","confirm","$msg","strDroppingForeignKey","getPostData","post","callback","strErrorProcessingRequest","windowWidth","width","css"],"sourceRoot":""}