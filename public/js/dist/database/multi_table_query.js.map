{"version":3,"file":"database/multi_table_query.js","mappings":"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","sources":["webpack://phpmyadmin/./resources/js/src/database/multi_table_query.ts","webpack://phpmyadmin/external var \"jQuery\""],"sourcesContent":["import $ from 'jquery';\nimport { AJAX } from '../modules/ajax.ts';\nimport { copyToClipboard, displayCopyNotification, getSqlEditor } from '../modules/functions.ts';\nimport { CommonParams } from '../modules/common.ts';\nimport { ajaxShowMessage } from '../modules/ajax-message.ts';\nimport { escapeBacktick } from '../modules/functions/escape.ts';\n/**\n * @fileoverview    function used in QBE for DB\n * @name            Database Operations\n *\n * @requires    jQueryUI\n * @requires    js/database/query_generator.js\n */\n/**\n * js file for handling AJAX and other events in /database/multi-table-query\n */\n/**\n * Unbind all event handlers before tearing down a page\n */\nAJAX.registerTeardown('database/multi_table_query.js', function () {\n    $('.tableNameSelect').each(function () {\n        $(this).off('change');\n    });\n    $('.columnNameSelect').each(function () {\n        $(this).off('change');\n    });\n    $('.criteria_op').each(function () {\n        $(this).off('change');\n    });\n    $('#update_query_button').off('click');\n    $('#copy_query').off('click');\n    $('#add_column_button').off('click');\n    $('body').off('click', 'input.add-option');\n    $('body').off('click', 'input.remove-option');\n});\nAJAX.registerOnload('database/multi_table_query.js', function () {\n    var editor = getSqlEditor($('#MultiSqlquery'), {}, 'vertical');\n    $('.CodeMirror-line').css('text-align', 'left');\n    editor.setSize(-1, -1);\n    var columnCount = 3;\n    addNewColumnCallbacks();\n    function opsWithMultipleArgs() {\n        return ['IN (...)', 'NOT IN (...)'];\n    }\n    function opsWithTwoArgs() {\n        return ['BETWEEN', 'NOT BETWEEN'];\n    }\n    $('#update_query_button').on('click', function () {\n        var columns = [];\n        var tableAliases = {};\n        $('.tableNameSelect').each(function () {\n            var $show = $(this).siblings('.show_col').first();\n            if ($(this).val() !== '' && $show.prop('checked')) {\n                var tableAlias = $(this).siblings('.table_alias').first().val();\n                var columnAlias = $(this).siblings('.col_alias').first().val();\n                if (tableAlias !== '') {\n                    columns.push([tableAlias, $(this).siblings('.columnNameSelect').first().val()]);\n                }\n                else {\n                    columns.push([$(this).val(), $(this).siblings('.columnNameSelect').first().val()]);\n                }\n                columns[columns.length - 1].push(columnAlias);\n                if ($(this).val() in tableAliases) {\n                    if (!(tableAliases[$(this).val()].includes(tableAlias))) {\n                        tableAliases[$(this).val()].push(tableAlias);\n                    }\n                }\n                else {\n                    tableAliases[$(this).val()] = [tableAlias];\n                }\n            }\n        });\n        if (Object.keys(tableAliases).length === 0) {\n            ajaxShowMessage('Nothing selected', false, 'error');\n            return;\n        }\n        var foreignKeys;\n        $.ajax({\n            type: 'GET',\n            async: false,\n            url: 'index.php?route=/database/multi-table-query/tables',\n            data: {\n                'server': sessionStorage.server,\n                'db': $('#db_name').val(),\n                'tables': Object.keys(tableAliases),\n                'ajax_request': '1',\n                'token': CommonParams.get('token')\n            },\n            success: function (response) {\n                foreignKeys = response.foreignKeyConstrains;\n            }\n        });\n        var query = 'SELECT ' + '`' + escapeBacktick(columns[0][0]) + '`.';\n        if (columns[0][1] === '*') {\n            query += '*';\n        }\n        else {\n            query += '`' + escapeBacktick(columns[0][1]) + '`';\n        }\n        if (columns[0][2] !== '') {\n            query += ' AS `' + escapeBacktick(columns[0][2]) + '`';\n        }\n        for (var i = 1; i < columns.length; i++) {\n            query += ', `' + escapeBacktick(columns[i][0]) + '`.';\n            if (columns[i][1] === '*') {\n                query += '*';\n            }\n            else {\n                query += '`' + escapeBacktick(columns[i][1]) + '`';\n            }\n            if (columns[i][2] !== '') {\n                query += ' AS `' + escapeBacktick(columns[i][2]) + '`';\n            }\n        }\n        query += '\\nFROM ';\n        query += window.generateFromBlock(tableAliases, foreignKeys);\n        var $criteriaColCount = $('.criteria_col:checked').length;\n        if ($criteriaColCount > 0) {\n            query += '\\nWHERE ';\n            query += window.generateWhereBlock();\n        }\n        query += ';';\n        editor.getDoc().setValue(query);\n    });\n    $('#submit_query').on('click', function () {\n        var query = editor.getDoc().getValue();\n        // Verifying that the query is not empty\n        if (query === '') {\n            ajaxShowMessage(window.Messages.strEmptyQuery, false, 'error');\n            return;\n        }\n        var data = {\n            'db': $('#db_name').val(),\n            'sql_query': query,\n            'ajax_request': '1',\n            'server': CommonParams.get('server'),\n            'token': CommonParams.get('token')\n        };\n        $.ajax({\n            type: 'POST',\n            url: 'index.php?route=/database/multi-table-query/query',\n            data: data,\n            success: function (data) {\n                var $resultsDom = $(data.message);\n                $resultsDom.find('.ajax:not(.pageselector)').each(function () {\n                    $(this).on('click', function (event) {\n                        event.preventDefault();\n                    });\n                });\n                $resultsDom.find('.autosubmit, .pageselector, .showAllRows, .filter_rows').each(function () {\n                    $(this).on('change click select focus', function (event) {\n                        event.preventDefault();\n                    });\n                });\n                // @ts-ignore\n                $('#sql_results').html($resultsDom);\n                $('#slide-handle').trigger('click'); // Collapse search criteria area\n            }\n        });\n    });\n    editor.getDoc().on('change', function () {\n        const query = editor.getDoc().getValue();\n        $('#copy_query').prop('disabled', query === '');\n    });\n    $('#copy_query').on('click', function () {\n        const query = editor.getDoc().getValue();\n        const copyStatus = copyToClipboard(query, '<textarea>');\n        displayCopyNotification(copyStatus);\n    });\n    $('#add_column_button').on('click', function () {\n        columnCount++;\n        var $newColumnDom = $('<div class=\"col\"></div>').html($('#new_column_layout').html());\n        $newColumnDom.find('.jsCriteriaButton').first().attr('data-bs-target', '#criteriaOptionsExtra' + columnCount.toString());\n        $newColumnDom.find('.jsCriteriaButton').first().attr('aria-controls', 'criteriaOptionsExtra' + columnCount.toString());\n        $newColumnDom.find('.jsCriteriaOptions').first().attr('id', 'criteriaOptionsExtra' + columnCount.toString());\n        $('#add_column_button').parent().siblings('.row').append($newColumnDom);\n        addNewColumnCallbacks();\n    });\n    $('.columnNameSelect').each(function () {\n        $(this).on('change', function () {\n            const colIsStar = $(this).val() === '*';\n            colIsStar && $(this).siblings('.col_alias').val('');\n            $(this).siblings('.col_alias').prop('disabled', colIsStar);\n        });\n    });\n    const acceptsMultipleArgs = opsWithMultipleArgs();\n    const acceptsTwoArgs = opsWithTwoArgs();\n    $('.criteria_op').each(function () {\n        $(this).on('change', function () {\n            if (acceptsMultipleArgs.includes($(this).val().toString())) {\n                showMultiFields($(this));\n            }\n            else if (acceptsTwoArgs.includes($(this).val().toString())) {\n                showTwoFields($(this));\n            }\n            else {\n                const options = $(this).closest('table').find('.options');\n                options.parent().prepend('<input type=\"text\" class=\"rhs_text_val query-form__input--wide\" placeholder=\"Enter criteria as free text\"></input>');\n                options.remove();\n            }\n        });\n    });\n    function showTwoFields(opSelect) {\n        const critetiaRow = opSelect.closest('table').find('.rhs_text');\n        const critetiaCol = critetiaRow.find('td').last();\n        const criteriaInput = critetiaCol.find('input').first();\n        if (critetiaCol.find('.binary').length === 0) {\n            critetiaCol.empty();\n            critetiaCol.append(`\n                <div class=\"options binary\">\n                    <input type=\"text\" class=\"val\" placeholder=\"${window.Messages.strFirstValuePlaceholder}\" value=\"${criteriaInput.val()}\" />\n                    <input type=\"text\" class=\"val\" placeholder=\"${window.Messages.strSecondValuePlaceholder}\" />\n                </div>\n            `);\n        }\n    }\n    function showMultiFields(opSelect) {\n        const critetiaRow = opSelect.closest('table').find('.rhs_text');\n        const critetiaCol = critetiaRow.find('td').last();\n        const criteriaInput = critetiaCol.find('input').first();\n        if (critetiaCol.find('.multi').length === 0) {\n            critetiaCol.empty();\n            critetiaCol.append(`\n                <div class=\"options multi\">\n                    <div class=\"option\">\n                        <input type=\"text\" class=\"val\" placeholder=\"Enter an option\" value=\"${criteriaInput.val()}\" />\n                        <input type=\"button\" class=\"btn btn-secondary add-option\" value=\"+\" />\n                    </div>\n                </div>\n            `);\n        }\n    }\n    $('body').on('click', 'input.add-option', function () {\n        const options = $(this).closest('.options');\n        options.find('.option').first().clone().appendTo(options);\n        const newAdded = options.find('.option').last();\n        newAdded.find('input.val').val('');\n        newAdded.append('<input type=\"button\" class=\"btn btn-secondary remove-option\" value=\"-\" />');\n    });\n    $('body').on('click', 'input.remove-option', function () {\n        $(this).closest('.option').remove();\n    });\n    function addNewColumnCallbacks() {\n        $('.tableNameSelect').each(function () {\n            $(this).on('change', function () {\n                const $table = $(this);\n                const $alias = $table.siblings('.col_alias');\n                const $colsSelect = $table.parent().find('.columnNameSelect');\n                $alias.prop('disabled', true);\n                $colsSelect.each(function () {\n                    $(this).show();\n                    $(this).first().html($('#' + $table.find(':selected').data('hash')).html());\n                    if ($(this).hasClass('opColumn')) {\n                        $(this).find('option[value=\"*\"]').remove();\n                    }\n                });\n            });\n        });\n        $('.jsRemoveColumn').each(function () {\n            $(this).on('click', function () {\n                $(this).parent().parent().parent().remove();\n            });\n        });\n        $('.jsCriteriaButton').each(function () {\n            $(this).on('click', function (event, from) {\n                if (from === null) {\n                    var $checkbox = $(this).siblings('.criteria_col').first();\n                    $checkbox.prop('checked', !$checkbox.prop('checked'));\n                }\n                var $criteriaColCount = $('.criteria_col:checked').length;\n                if ($criteriaColCount > 1) {\n                    $(this).siblings('.jsCriteriaOptions').first().find('.logical_operator').first().css('display', 'table-row');\n                }\n            });\n        });\n        $('.criteria_col').each(function () {\n            $(this).on('change', function () {\n                var $anchor = $(this).siblings('.jsCriteriaButton').first();\n                if (($(this).is(':checked') && !$anchor.hasClass('collapsed'))\n                    || (!$(this).is(':checked') && $anchor.hasClass('collapsed'))) {\n                    // Do not collapse on checkbox tick as it does not make sense\n                    // The user has it open and wants to tick the box\n                    return;\n                }\n                $anchor.trigger('click', ['Trigger']);\n            });\n        });\n        $('.criteria_rhs').each(function () {\n            $(this).on('change', function () {\n                var $rhsCol = $(this).parent().parent().siblings('.rhs_table').first();\n                var $rhsText = $(this).parent().parent().siblings('.rhs_text').first();\n                if ($(this).val() === 'text') {\n                    $rhsCol.css('display', 'none');\n                    $rhsText.css('display', 'table-row');\n                }\n                else if ($(this).val() === 'anotherColumn') {\n                    $rhsText.css('display', 'none');\n                    $rhsCol.css('display', 'table-row');\n                }\n                else {\n                    $rhsText.css('display', 'none');\n                    $rhsCol.css('display', 'none');\n                }\n            });\n        });\n    }\n});\n","module.exports = jQuery;"],"names":["$","AJAX","copyToClipboard","displayCopyNotification","getSqlEditor","CommonParams","ajaxShowMessage","escapeBacktick","registerTeardown","each","off","registerOnload","editor","css","setSize","columnCount","addNewColumnCallbacks","opsWithMultipleArgs","opsWithTwoArgs","on","columns","tableAliases","$show","siblings","first","val","prop","tableAlias","columnAlias","push","length","includes","Object","keys","foreignKeys","ajax","type","async","url","data","sessionStorage","server","get","success","response","foreignKeyConstrains","query","i","window","generateFromBlock","$criteriaColCount","generateWhereBlock","getDoc","setValue","getValue","Messages","strEmptyQuery","$resultsDom","message","find","event","preventDefault","html","trigger","copyStatus","$newColumnDom","attr","toString","parent","append","colIsStar","acceptsMultipleArgs","acceptsTwoArgs","showMultiFields","showTwoFields","options","closest","prepend","remove","opSelect","critetiaRow","critetiaCol","last","criteriaInput","empty","concat","strFirstValuePlaceholder","strSecondValuePlaceholder","clone","appendTo","newAdded","$table","$alias","$colsSelect","show","hasClass","from","$checkbox","$anchor","is","$rhsCol","$rhsText"],"sourceRoot":""}