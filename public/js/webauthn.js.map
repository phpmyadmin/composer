{"version":3,"file":"webauthn.js","mappings":"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","sources":["webpack://phpmyadmin/./resources/js/webauthn.ts","webpack://phpmyadmin/external var \"jQuery\""],"sourcesContent":["import $ from 'jquery';\nimport { AJAX } from './modules/ajax.ts';\nimport { ajaxShowMessage } from './modules/ajax-message.ts';\n/**\n * @param {ArrayBuffer} buffer\n *\n * @return {string}\n */\nconst arrayBufferToBase64 = buffer => {\n    const bytes = new Uint8Array(buffer);\n    let string = '';\n    for (const byte of bytes) {\n        string += String.fromCharCode(byte);\n    }\n    return window.btoa(string);\n};\n/**\n * @param {string} string\n *\n * @return {Uint8Array}\n */\nconst base64ToUint8Array = string => {\n    return Uint8Array.from(window.atob(string), char => char.charCodeAt(0));\n};\n/**\n * @param {JQuery<HTMLElement>} $input\n */\nconst handleCreation = ($input) => {\n    const $form = $input.parents('form');\n    $form.find('input[type=submit]').hide();\n    const creationOptionsJson = $input.attr('data-creation-options');\n    const creationOptions = JSON.parse(creationOptionsJson);\n    const publicKey = creationOptions;\n    publicKey.challenge = base64ToUint8Array(creationOptions.challenge);\n    publicKey.user.id = base64ToUint8Array(creationOptions.user.id);\n    if (creationOptions.excludeCredentials) {\n        const excludedCredentials = [];\n        for (let value of creationOptions.excludeCredentials) {\n            let excludedCredential = value;\n            excludedCredential.id = base64ToUint8Array(value.id);\n            excludedCredentials.push(excludedCredential);\n        }\n        publicKey.excludeCredentials = excludedCredentials;\n    }\n    // eslint-disable-next-line compat/compat\n    navigator.credentials.create({ publicKey: publicKey })\n        .then((credential) => {\n        const credentialJson = JSON.stringify({\n            id: credential.id,\n            rawId: arrayBufferToBase64(credential.rawId),\n            type: credential.type,\n            response: {\n                clientDataJSON: arrayBufferToBase64(credential.response.clientDataJSON),\n                attestationObject: arrayBufferToBase64(credential.response.attestationObject),\n            }\n        });\n        $input.val(credentialJson);\n        $form.trigger('submit');\n    })\n        .catch((error) => ajaxShowMessage(error, false, 'error'));\n};\n/**\n * @param {JQuery<HTMLElement>} $input\n */\nconst handleRequest = ($input) => {\n    const $form = $input.parents('form');\n    $form.find('input[type=submit]').hide();\n    const requestOptionsJson = $input.attr('data-request-options');\n    const requestOptions = JSON.parse(requestOptionsJson);\n    const publicKey = requestOptions;\n    publicKey.challenge = base64ToUint8Array(requestOptions.challenge);\n    if (requestOptions.allowCredentials) {\n        const allowedCredentials = [];\n        for (let value of requestOptions.allowCredentials) {\n            let allowedCredential = value;\n            allowedCredential.id = base64ToUint8Array(value.id);\n            allowedCredentials.push(allowedCredential);\n        }\n        publicKey.allowCredentials = allowedCredentials;\n    }\n    // eslint-disable-next-line compat/compat\n    navigator.credentials.get({ publicKey: publicKey })\n        .then((credential) => {\n        const credentialJson = JSON.stringify({\n            id: credential.id,\n            rawId: arrayBufferToBase64(credential.rawId),\n            type: credential.type,\n            response: {\n                authenticatorData: arrayBufferToBase64(credential.response.authenticatorData),\n                clientDataJSON: arrayBufferToBase64(credential.response.clientDataJSON),\n                signature: arrayBufferToBase64(credential.response.signature),\n                userHandle: arrayBufferToBase64(credential.response.userHandle),\n            }\n        });\n        $input.val(credentialJson);\n        $form.trigger('submit');\n    })\n        .catch((error) => ajaxShowMessage(error, false, 'error'));\n};\nAJAX.registerOnload('webauthn.js', function () {\n    if (!navigator.credentials\n        || !navigator.credentials.create\n        || !navigator.credentials.get\n        || !window.PublicKeyCredential) {\n        ajaxShowMessage(window.Messages.webAuthnNotSupported, false, 'error');\n        return;\n    }\n    const $creationInput = $('#webauthn_creation_response');\n    if ($creationInput.length > 0) {\n        handleCreation($creationInput);\n    }\n    const $requestInput = $('#webauthn_request_response');\n    if ($requestInput.length > 0) {\n        handleRequest($requestInput);\n    }\n});\n","module.exports = jQuery;"],"names":["$","AJAX","ajaxShowMessage","arrayBufferToBase64","buffer","bytes","Uint8Array","string","byte","String","fromCharCode","window","btoa","base64ToUint8Array","from","atob","char","charCodeAt","handleCreation","$input","$form","parents","find","hide","creationOptionsJson","attr","creationOptions","JSON","parse","publicKey","challenge","user","id","excludeCredentials","excludedCredentials","value","excludedCredential","push","navigator","credentials","create","then","credential","credentialJson","stringify","rawId","type","response","clientDataJSON","attestationObject","val","trigger","catch","error","handleRequest","requestOptionsJson","requestOptions","allowCredentials","allowedCredentials","allowedCredential","get","authenticatorData","signature","userHandle","registerOnload","PublicKeyCredential","Messages","webAuthnNotSupported","$creationInput","length","$requestInput"],"sourceRoot":""}